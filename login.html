<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Usu치rio">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <p id="error" style="color: red;"></p>

    <script>
        async function fetchUsers() {
            try {
                const response = await fetch("https://raw.githubusercontent.com/CatalogoEstoque/index/main/User.xlsx");
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: "array" });
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const data = XLSX.utils.sheet_to_json(sheet);

                const users = {};
                data.forEach(row => {
                    if (row.username && row.password) {
                        users[row.username.trim()] = row.password.trim();
                    }
                });

                return users;
            } catch (error) {
                console.error("Erro ao carregar usu치rios:", error);
                return {};
            }
        }

        async function login() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const users = await fetchUsers();

            if (users[user] && users[user] === pass) {
                localStorage.setItem("loggedIn", "true");
                window.location.href = "index.html";
            } else {
                document.getElementById('error').innerText = "Usu치rio ou senha inv치lidos!";
            }
        }
    </script>
</body>
</html>
